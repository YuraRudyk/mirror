function round(t,s){if(1>s||s>14)return!1;var i=Math.pow(10,s),h=(Math.round(t*i)/i).toString();return-1==h.indexOf(".")&&(h+="."),h+=i.toString().substring(1),parseFloat(h.substring(0,h.indexOf(".")+s+1))}function Rahmen(t,s,i){this.canvas=$(t)[0],this.preview=s,this.previewCanvas=i||!1,this.scale=1,this.imgPaths={rahmen:"typo3conf/ext/glshop/Resources/Public/Img/Rahmen/"},this.lamps=null}Rahmen.prototype.log=function(t,s){console.log(t+("undefined"!=typeof s?": "+s:"")),console.log("-----------")},Rahmen.prototype.init=function(t,s,i,h,e,a,l){this.ctx=this.canvas.getContext("2d"),this.w=t,this.h=s,this.color=i,this.cW=this.canvas.width,this.cH=this.canvas.height,this.rW=h,this.lPower=e,this.light="#FFFA00",this.tOffset=30,this.lamps=l||{Links:!1,Oben:!1,Rechts:!1,Unten:!1},this.clearRahmen(),this.checkScale(),this.iniLampPosition(),this.drawLamps(),this.drawRahmen(),this.beschrifteKanten()},Rahmen.prototype.iniLampPosition=function(){this.lPos={l:{x:this.cW/2-this.scaleValue(this.w)/2-this.tOffset/6-this.tOffset/1.5,y:this.cH/2-35,w:this.tOffset/1.5,h:70},o:{x:this.cW/2-35,y:this.cH/2-this.scaleValue(this.h)/2-this.tOffset/6-this.tOffset/1.5,w:70,h:this.tOffset/1.5},r:{x:this.cW/2+this.scaleValue(this.w)/2-this.tOffset/2+this.tOffset/1.5,y:this.cH/2-35,w:this.tOffset/1.5,h:70},u:{x:this.cW/2-35,y:this.cH/2+this.scaleValue(this.h)/2-this.tOffset/2+this.tOffset/1.5,w:70,h:this.tOffset/1.5}}},Rahmen.prototype.checkScale=function(){var t=Number(this.w),s=Number(this.h),i=this.cW-2*this.tOffset,h=this.cH-2*this.tOffset;i>h?i>t&&h>s?t>s?this.scale=h/s:(s>t||t==s)&&(this.scale=h/s):t>i&&s>h?t>s?this.scale=i/t:(s>t||t==s)&&(this.scale=h/s):t>i&&h>s?this.scale=i/t:i>t&&s>h&&(this.scale=h/s):h>i?i>t&&h>s?t>s||t==s?this.scale=i/t:s>t&&(this.scale=h/s):t>i&&s>h?t>s||t==s?this.scale=i/t:s>t&&(this.scale=h/s):t>i&&h>s?this.scale=i/t:i>t&&s>h&&(this.scale=h/s):i==h&&(i>t&&h>s?t>s||t==s?this.scale=i/t:s>t&&(this.scale=h/s):t>i&&s>h?t>s||t==s?this.scale=i/t:s>t&&(this.scale=h/s):t>i&&h>s?this.scale=i/t:i>t&&s>h&&(this.scale=h/s))},Rahmen.prototype.clearRahmen=function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.cW,this.cH),this.ctx.restore()},Rahmen.prototype.scaleValue=function(t){return Number(this.scale*t)},Rahmen.prototype.drawRahmen=function(){this.ctx.lineWidth=.5,this.ctx.strokeStyle="rgba(0,0,0,0.6)",this.drawImg("l"),this.drawImg("o"),this.drawImg("r"),this.drawImg("u"),this.drawLamps()},Rahmen.prototype.drawLamps=function(){this.preview?this.drawFillLight():(this.lampLinks(),this.lampOben(),this.lampRechts(),this.lampUnten())},Rahmen.prototype.drawImg=function(t){var s=this,i=new Image;i.onload=function(){switch(t){case"l":s.drawRahmenLinks(i);break;case"o":s.drawRahmenOben(i);break;case"r":s.drawRahmenRechts(i);break;case"u":s.drawRahmenUnten(i)}},i.src=this.imgPaths.rahmen+this.color+"_klein_"+t+".jpg"},Rahmen.prototype.drawRahmenLinks=function(t){var s=this.ctx,i=this.scaleValue(this.rW),h=this.scaleValue(this.h),e=this.cW/2-this.scaleValue(this.w)/2,a=this.cH/2-h/2;s.save(),s.beginPath(),s.moveTo(e,a),s.lineTo(e,a+h),s.lineTo(e+i,a+h-i),s.lineTo(e+i,a+i),s.lineTo(e,a),s.closePath(),this.clippedBackgroundImage(t,i,h,e,a),s.stroke(),s.restore()},Rahmen.prototype.drawRahmenOben=function(t){var s=this.ctx,i=this.scaleValue(this.w),h=this.scaleValue(this.rW),e=this.cW/2-i/2,a=this.cH/2-this.scaleValue(this.h/2);s.save(),s.beginPath(),s.moveTo(e,a),s.lineTo(e+h,a+h),s.lineTo(e+i-h,a+h),s.lineTo(e+i,a),s.lineTo(e,a),s.closePath(),this.clippedBackgroundImage(t,i,h,e,a),s.stroke(),s.restore()},Rahmen.prototype.drawRahmenRechts=function(t){var s=this.ctx,i=this.scaleValue(this.rW),h=this.scaleValue(this.h),e=this.cW/2+this.scaleValue(this.w/2),a=this.cH/2-h/2;s.save(),s.beginPath(),s.moveTo(e,a),s.lineTo(e-i,a+i),s.lineTo(e-i,a+h-i),s.lineTo(e,a+h),s.lineTo(e,a),s.closePath(),this.clippedBackgroundImage(t,i,h,e-i,a),s.stroke(),s.restore()},Rahmen.prototype.drawRahmenUnten=function(t){var s=this.ctx,i=this.scaleValue(this.w),h=this.scaleValue(this.rW),e=this.cW/2-i/2,a=this.cH/2+this.scaleValue(this.h/2);s.save(),s.beginPath(),s.moveTo(e,a),s.lineTo(e+i,a),s.lineTo(e+i-h,a-h),s.lineTo(e+h,a-h),s.lineTo(e,a),s.closePath(),this.clippedBackgroundImage(t,i,h,e,a-h),s.stroke(),s.restore()},Rahmen.prototype.clippedBackgroundImage=function(t,s,i,h,e){var a=this.ctx;a.save(),a.clip(),a.drawImage(t,h,e,s,i),a.restore()},Rahmen.prototype.lampLinks=function(){var t=this.lPos.l.x,s=this.lPos.l.y,i=this.lPos.l.w,h=this.lPos.l.h,e={xS:t,yS:s,x1:t,y1:s+h,x2:t+i,y2:s+h,x3:t+i,y3:s};this.drawLines(e,"#fff","#000");var a={xS:t+i/2/2,yS:s+10,x1:t+i/2/2,y1:s+20,x2:t+i/2+5,y2:s+20,x3:t+i/2+5,y3:s+10},l={xS:t+i/2/2,yS:s+30,x1:t+i/2/2,y1:s+40,x2:t+i/2+5,y2:s+40,x3:t+i/2+5,y3:s+30},n={xS:t+i/2/2,yS:s+50,x1:t+i/2/2,y1:s+60,x2:t+i/2+5,y2:s+60,x3:t+i/2+5,y3:s+50};this.lamps.Links?(this.drawLines(a,this.light,"#000"),this.drawLines(l,this.light,"#000"),this.drawLines(n,this.light,"#000")):(this.drawLines(a,"#fff","#000"),this.drawLines(l,"#fff","#000"),this.drawLines(n,"#fff","#000")),this.drawFillLight()},Rahmen.prototype.lampOben=function(){var t=this.lPos.o.x,s=this.lPos.o.y,i=this.lPos.o.w,h=this.lPos.o.h,e={xS:t,yS:s,x1:t,y1:s+h,x2:t+i,y2:s+h,x3:t+i,y3:s};this.drawLines(e,"#fff","#000");var a={xS:t+10,yS:s+h/2/2,x1:t+20,y1:s+h/2/2,x2:t+20,y2:s+h/2+5,x3:t+10,y3:s+h/2+5},l={xS:t+30,yS:s+h/2/2,x1:t+40,y1:s+h/2/2,x2:t+40,y2:s+h/2+5,x3:t+30,y3:s+h/2+5},n={xS:t+50,yS:s+h/2/2,x1:t+60,y1:s+h/2/2,x2:t+60,y2:s+h/2+5,x3:t+50,y3:s+h/2+5};this.lamps.Oben?(this.drawLines(a,this.light,"#000"),this.drawLines(l,this.light,"#000"),this.drawLines(n,this.light,"#000")):(this.drawLines(a,"#fff","#000"),this.drawLines(l,"#fff","#000"),this.drawLines(n,"#fff","#000")),this.drawFillLight()},Rahmen.prototype.lampRechts=function(){var t=this.lPos.r.x,s=this.lPos.r.y,i=this.lPos.r.w,h=this.lPos.r.h,e={xS:t,yS:s,x1:t,y1:s+h,x2:t+i,y2:s+h,x3:t+i,y3:s};this.drawLines(e,"#fff","#000");var a={xS:t+i/2/2,yS:s+10,x1:t+i/2/2,y1:s+20,x2:t+i/2+5,y2:s+20,x3:t+i/2+5,y3:s+10},l={xS:t+i/2/2,yS:s+30,x1:t+i/2/2,y1:s+40,x2:t+i/2+5,y2:s+40,x3:t+i/2+5,y3:s+30},n={xS:t+i/2/2,yS:s+50,x1:t+i/2/2,y1:s+60,x2:t+i/2+5,y2:s+60,x3:t+i/2+5,y3:s+50};this.lamps.Rechts?(this.drawLines(a,this.light,"#000"),this.drawLines(l,this.light,"#000"),this.drawLines(n,this.light,"#000")):(this.drawLines(a,"#fff","#000"),this.drawLines(l,"#fff","#000"),this.drawLines(n,"#fff","#000")),this.drawFillLight()},Rahmen.prototype.lampUnten=function(){var t=this.lPos.u.x,s=this.lPos.u.y,i=this.lPos.u.w,h=this.lPos.u.h,e={xS:t,yS:s,x1:t,y1:s+h,x2:t+i,y2:s+h,x3:t+i,y3:s};this.drawLines(e,"#fff","#000");var a={xS:t+10,yS:s+h/2/2,x1:t+20,y1:s+h/2/2,x2:t+20,y2:s+h/2+5,x3:t+10,y3:s+h/2+5},l={xS:t+30,yS:s+h/2/2,x1:t+40,y1:s+h/2/2,x2:t+40,y2:s+h/2+5,x3:t+30,y3:s+h/2+5},n={xS:t+50,yS:s+h/2/2,x1:t+60,y1:s+h/2/2,x2:t+60,y2:s+h/2+5,x3:t+50,y3:s+h/2+5};this.lamps.Unten?(this.drawLines(a,this.light,"#000"),this.drawLines(l,this.light,"#000"),this.drawLines(n,this.light,"#000")):(this.drawLines(a,"#fff","#000"),this.drawLines(l,"#fff","#000"),this.drawLines(n,"#fff","#000")),this.drawFillLight()},Rahmen.prototype.drawLines=function(t,s,i){var h=this.ctx;h.save(),h.beginPath(),h.moveTo(t.xS,t.yS),h.lineTo(t.x1,t.y1),h.lineTo(t.x2,t.y2),h.lineTo(t.x3,t.y3),h.lineTo(t.xS,t.yS),h.closePath(),h.fillStyle=s,h.strokeStyle=i,h.lineWidth=1,h.fill(),h.stroke(),h.restore()},Rahmen.prototype.drawFillLight=function(){var t=(this.ctx,this.scaleValue(this.lPower)),s=this.scaleValue(this.w)-2*this.scaleValue(this.rW)-2,i=this.scaleValue(this.h)-2*this.scaleValue(this.rW)-2,h=this.cW/2-this.scaleValue(this.w)/2+this.scaleValue(this.rW)+1,e=this.cH/2-i/2;if(this.lamps.Links){t>s&&(t=s);var a={xS:h,yS:e,x1:h,y1:e+i,x2:h+t,y2:e+i,x3:h+t,y3:e};this.drawLines(a,this.light,this.light)}if(this.lamps.Oben){t>i&&(t=i);var l={xS:h,yS:e,x1:h,y1:e+t,x2:h+s,y2:e+t,x3:h+s,y3:e};this.drawLines(l,this.light,this.light)}if(this.lamps.Rechts){t>s&&(t=s);var n={xS:h+s,yS:e,x1:h+s-t,y1:e,x2:h+s-t,y2:e+i,x3:h+s,y3:e+i};this.drawLines(n,this.light,this.light)}if(this.lamps.Unten){t>i&&(t=i);var r={xS:h,yS:e+i,x1:h+s,y1:e+i,x2:h+s,y2:e+i-t,x3:h,y3:e+i-t};this.drawLines(r,this.light,this.light)}},Rahmen.prototype.drawFillLights=function(){var t=this.ctx,s=this.scaleValue(this.lPower),i=this.scaleValue(this.w)-2*this.scaleValue(this.rW)-2,h=this.scaleValue(this.h)-2*this.scaleValue(this.rW)-2,e=this.cW/2-this.scaleValue(this.w)/2+this.scaleValue(this.rW)+1,a=this.cH/2-h/2;t.beginPath();var l=0;if(this.lamps.Links){l=round(s/i,2),l>1&&(l=1);var n=t.createLinearGradient(e,(h+a)/2,i+e,(h+a)/2);n.addColorStop(0,this.light),n.addColorStop(l,"rgba(233,255,111,"+l+")")}if(this.lamps.Oben){l=s/h,l>1&&(l=1);var r=t.createLinearGradient((i+e)/2,a,(i+e)/2,h+a);r.addColorStop(0,this.light),r.addColorStop(l,"rgba(233,255,111,"+l+")")}if(this.lamps.Rechts){l=s/i,l>1&&(l=1);var o=t.createLinearGradient(i+e,(h+a)/2,e,(h+a)/2);o.addColorStop(0,this.light),o.addColorStop(l,"rgba(233,255,111,"+l+")")}if(this.lamps.Unten){l=s/h,l>1&&(l=1);var c=t.createLinearGradient((i+e)/2,h+a,(i+e)/2,a);c.addColorStop(0,this.light),c.addColorStop(l,"rgba(233,255,111,"+l+")")}t.fillStyle="rgba(255,255,255,1)",t.fillRect(e,a,i,h),this.lamps.Unten&&(t.fillStyle=c,t.fillRect(e,a,i,h)),this.lamps.Rechts&&(t.fillStyle=o,t.fillRect(e,a,i,h)),this.lamps.Oben&&(t.fillStyle=r,t.fillRect(e,a,i,h)),this.lamps.Links&&(t.fillStyle=n,t.fillRect(e,a,i,h))},Rahmen.prototype.getLamps=function(){return this.lamps},Rahmen.prototype.beschrifteKanten=function(){var t="12pt Verdana, sans-serif",s=0,i=0,h=0,e=0,a=0,l=0,n=0,r=0,o=this.lPos.l.x,c=this.lPos.l.y,f=this.lPos.l.h,y=this.lPos.o.x,x=this.lPos.o.y,d=this.lPos.o.w,p=this.lPos.o.h,m=this.lPos.r.x,u=this.lPos.r.y,w=this.lPos.r.h,g=this.lPos.u.x,S=this.lPos.u.y,L=this.lPos.u.w,R=this.lPos.u.h;return this.preview?(s=o,i=c+f/2,h=y+d/3+5,e=x+p,a=m,l=u+w/2,n=g+L/3+5,r=S+R-5):(s=o,i=c-10,h=y-30,e=x+p-5,a=m,l=u-10,n=g+L+10,r=S+R-5),this.addText("L",s,i,t).addText("O",h,e,t).addText("R",a,l,t).addText("U",n,r,t),this},Rahmen.prototype.addText=function(t,s,i,h){var e=this.ctx;return e.font=h,e.fillText(t,s,i),this};