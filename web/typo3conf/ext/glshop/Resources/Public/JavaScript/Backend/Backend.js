jQuery.noConflict(),function($){$(function(){var API={isset:function(e){return void 0!==e&&null!=e},getMaterial:function(e,t,a){for(var n=e.material,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].varianten.length;l++)n[i].varianten[l].uid==a&&(r.varianten=n[i].varianten[l])}return r},getProduct:function(e,t,a){for(var n=e.halter,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].varianten.length;l++)n[i].varianten[l].uid==a&&(r.varianten=n[i].varianten[l])}return r},getKanten:function(e,t){for(var a=e.kanten,n=null,r=0;r<a.length;r++)a[r].uid==t&&(n=a[r]);return n},getBohrungen:function(e,t){for(var a=e.bohrungen,n=new Array,r=0;r<t.length;r++)for(var i=0;i<a.length;i++)a[i].uid==t[r].uid&&n.push({name:a[i].name,ecke:t[r].corner,dB:t[r].dB,x:t[r].x,y:t[r].y});return n},getEcken:function(e,t){for(var a=e.ecken,n=new Array,r=0;r<t.length;r++)for(var i=0;i<a.length;i++)a[i].uid==t[r].uid&&n.push({name:a[i].name,ecke:t[r].corner,r:t[r].radius,x:t[r].x,y:t[r].y});return n},getAnschluss:function(e,t,a){for(var n=e.produktart.anschluss,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].variante.length;l++)n[i].variante[l].uid==a&&(r.variante=n[i].variante[l])}return r},getFrontscheibe:function(e,t,a){for(var n=e.produktart.frontscheiben,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].variante.length;l++)n[i].variante[l].uid==a&&(r.variante=n[i].variante[l])}return r},getLeds:function(e,t,a){for(var n=e.produktart.leds,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].variante.length;l++)n[i].variante[l].uid==a&&(r.variante=n[i].variante[l])}return r},getMontage:function(e,t,a){for(var n=e.produktart.montage,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].variante.length;l++)n[i].variante[l].uid==a&&(r.variante=n[i].variante[l])}return r},getProfile:function(e,t,a){for(var n=e.produktart.profile,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].variante.length;l++)n[i].variante[l].uid==a&&(r.variante=n[i].variante[l])}return r},getRueckwand:function(e,t,a){for(var n=e.produktart.rueckwand,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].variante.length;l++)n[i].variante[l].uid==a&&(r.variante=n[i].variante[l])}return r},getStreuplatte:function(e,t,a){for(var n=e.produktart.streuplatten,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].variante.length;l++)n[i].variante[l].uid==a&&(r.variante=n[i].variante[l])}return r},getZubehoer:function(e,t,a){for(var n=e.produktart.zubehoer,r=null,i=0;i<n.length;i++)if(n[i].uid==t){r=n[i];for(var l=0;l<n[i].variante.length;l++)n[i].variante[l].uid==a&&(r.variante=n[i].variante[l])}return r},priceView:function(e){var t=",",a=".";return function(e,n,r){n||(n=0);var i="",l=e<0?"-":"",o=Math.pow(10,n),s=Math.abs(e),d=(s=""+parseInt(s*o+.5)/o).indexOf(".");for(r&&n&&(s+=(-1==d?".":"")+o.toString().substring(1)),-1==(d=s.indexOf("."))?d=s.length:i=t+s.substr(d+1,n);d>0;)i=d-3>0?a+s.substring(d-3,d)+i:s.substring(0,d)+i,d-=3;return l+i}(e,2,!0)}};$("body").on("click",".showTimDataBtn",function(e){$(this).next("div.show-tim-data-area").toggle()}),$(".glshop_table").dataTable({language:{url:"//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/German.json"},order:[[2,"desc"]],bProcessing:!0,bDeferRender:!0,bAutoWidth:!1,bJQueryUI:!0,columnDefs:[{type:"natural",targets:0},{type:"de_datetime",targets:2}]}),$("body").on("click",".stButton",function(e){e.preventDefault();var t=createFile($(this).val(),"st");createDownload(t.fileName,"st"),t.fileName&&$(this).css("background-color","red")});var Template={getAB:{orderData:null,ini:function(e){this.orderData=e},artikel:function(e){var t="";for(var a in e)t+="<tr>",t+='<td style="text-align: center;">',t+='<button type="button" class="btn btn-default" aria-label="Löschen">',t+='<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>',t+="</button>",t+="</td>",t+='<td style="text-align: center;">'+a+"</td>",t+='<td style="text-align: center;"><img /></td>',t+='<td style="text-align: center;">',t+='<input type="text" value="'+e[a].anzahl+'" class="form-control">',t+="</td>",API.isset(e[a].artikel.materialConfig)?t+=this.getSchild(e[a].artikel):API.isset(e[a].artikel.halter)?t+=this.getHalter(e[a].artikel):API.isset(e[a].artikel.profil)?t+=this.getRahmen(e[a].artikel):API.isset(e[a].artikel.voucher)&&(t+=this.getVoucher(e[a].artikel)),t+='<td style="text-align: center;">'+API.priceView(e[a].preis)+"</td>",t+='<td style="text-align: right;">'+API.priceView(parseFloat(e[a].preis)*parseInt(e[a].anzahl))+"</td>",t+="</tr>",t+=parseFloat(e[a].preis)*parseInt(e[a].anzahl);return t},getVoucher:function(e){var t="";return t+='<td style="text-align: left;">&nbsp;</td>',t+='<td style="text-align: left;"><b>Gutschein: </b>'+e.voucher+"</td>",t+='<td style="font-size:smaller;">&nbsp;</td>'},getSchild:function(e){var t="",a=API.getMaterial(this.orderData.data,e.material.uid,e.material.vid),n=API.getKanten(this.orderData.data,e.bearbeitungen.kanten.uid),r=API.isset(e.bearbeitungen.ecken)?API.getEcken(this.orderData.data,e.bearbeitungen.ecken):null,i=API.isset(e.bearbeitungen.bohrungen)?API.getBohrungen(this.orderData.data,e.bearbeitungen.bohrungen):null;if(t+='<td style="text-align: left;">'+e.materialConfig.width+" x "+e.materialConfig.height+" x "+e.material.size+"mm</td>",t+='<td style="text-align: left;">'+a.name+"<br />"+a.varianten.name+"</td>",t+='<td style="font-size:smaller;">',t+="<b>Kantenbearbeitung: </b> <br/>"+n.name+"<br/>",API.isset(r)){t+="<b>Eckbearbeitung: </b>";for(var l=0;l<r.length;l++)t+="<br />"+r[l].name+": "+r[l].ecke+" -> "+(""!=r[l].r?r[l].r+" mm":r[l].x+" x "+r[l].y+" mm");t+="<br/>"}if(API.isset(i)){t+="<b>Bohrungen: </b>";for(l=0;l<i.length;l++)t+="<br />"+i[l].name+": "+i[l].ecke+" -> "+i[l].x+" x "+i[l].y+" mm";t+="<br/>"}return t+="</td>"},getHalter:function(e){var t="",a=API.getProduct(this.orderData.data,e.halter.uid,e.halter.vid);return t+='<td style="text-align: left;">Art.Nr.: '+a.varianten.artnr+"</td>",t+='<td style="text-align: left;">'+a.name+"<br />"+a.varianten.name+"</td>",t+='<td style="text-align: left;">&nbsp;</td>'},getRahmen:function(e){var t="",a=API.getProfile(this.orderData.data,e.profil.uid,e.profil.vid),n=API.getFrontscheibe(this.orderData.data,e.frontscheibe.uid,e.frontscheibe.vid),r=API.getLeds(this.orderData.data,e.led.uid,e.led.vid),i=API.getStreuplatte(this.orderData.data,e.streuplatte.uid,e.streuplatte.vid),l=API.getAnschluss(this.orderData.data,e.netzanschluss.uid,e.netzanschluss.vid),o=API.getMontage(this.orderData.data,e.befestigung.uid,e.befestigung.vid),s=e.kanten;return t+='<td style="text-align: left;">'+e.rahmenConfig.width+" x "+e.rahmenConfig.height+" mm</td>",t+='<td style="text-align: left;">'+a.name+" - "+a.variante.name+"</td>",t+='<td style="text-align: left; font-size:smaller;">',t+="<b>Au&szlig;enma&szlig;e:</b><br/> "+e.rahmenConfig.width+" x "+e.rahmenConfig.height+" mm <br/>",API.isset(n)&&(t+="<b>Frontscheibe:</b> <br/>"+n.name+" <br/> "+n.variante.name+" <br/>"),t+="<b>Beleuchtung:</b><br/>",t+="<b>Lichtfarbe:</b> "+r.name+" <br/>",t+="<b>Steuerung:</b> ","weiß"==r.name?t+=" Farbe fest eingestellt - "+r.variante.name+"<br />":t+=r.variante.name+"<br />",t+="<b>Profile mit Led's:</b> <br/>","true"==s.Links&&(t+=" Links "),"true"==s.Oben&&(t+=" Oben "),"true"==s.Rechts&&(t+=" Rechts "),"true"==s.Unten&&(t+=" Unten "),t+=" <br/>",t+="<b>Lichtstreuplatte:</b> <br/>"+i.variante.name+" <br/> "+i.name+" <br/>",t+="<b>Netzanschluss:</b> <br/>"+l.name+" <br/> "+l.variante.name+" <br/>",t+="<b>Befestigung:</b> <br/>"+o.name+" <br/> "+o.variante.name+" <br/>",t+="</td>"}}};function showAbschlussData(e){for(var t="",a=0,n=0,r=0,i=0;i<e.length;i++)t+="<tr>",t+="<td>"+e[i].rgNr+"</td>",t+="<td>"+e[i].rgDatum+"</td>",t+="<td>"+e[i].auNr+"</td>",t+="<td>"+e[i].kdNr+"</td>",t+="<td>"+e[i].kdName+"</td>",t+="<td>"+API.priceView(e[i].netto)+"</td>",t+="<td>"+e[i].mwstSatz+"</td>",t+="<td>"+API.priceView(e[i].steuer)+"</td>",t+="<td>"+API.priceView(e[i].brutto)+"</td>",t+="</tr>",r+=Number(e[i].netto),n+=Number(e[i].brutto),a+=Number(e[i].steuer);$("#abschluss-tabelle tbody").html(t),$(".sumNetto").html(API.priceView(r)),$(".taxSum").html(API.priceView(a)),$(".sumBrutto").html(API.priceView(n)),$("#abschluss-tabelle").dataTable({language:{url:"//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/German.json"},order:[[0,"asc"]],bProcessing:!0,bDeferRender:!0,bAutoWidth:!1,bJQueryUI:!0,bDestroy:!0,columnDefs:[{type:"natural",targets:0},{type:"de_datetime",targets:2}]})}function createDownload(e,t){var a=$("#preparing-file-modal");a.dialog({modal:!0});var n=top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::sendFileAction"],r=new Object;return r.arguments={fileName:e,type:t},$.fileDownload(n,{successCallback:function(e){a.dialog("close")},failCallback:function(e,t){a.dialog("close"),$("#error-modal").dialog({modal:!0})},data:r}),!1}function createFile(e,t){var a=new Object;return a.arguments={uid:e,opt:t},ajax(top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::getFileAction"],!1,a,"GET","json")}function checkAB(e){var t=new Object;return t.arguments={uid:e},ajax(top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::checkABAction"],!1,t,"GET","json").abSet}function ajax(ajaxUrl,async,data,type,dataType,sMsg,eMsg){var res=$.ajax({url:ajaxUrl,async:async,global:!1,data:data,type:type,dataType:dataType,success:function(){null!=sMsg&&alert(sMsg)},error:function(){null!=eMsg&&alert(eMsg)}}).responseText;return"json"==dataType&&""!=res&&null!=res&&res.length>0&&(res=eval("("+res+")")),res}$("body").on("click",".abButton",function(e){e.preventDefault();var t=$(this).find("span").html();$("#order-uid-ab-dialog").val(t);var a=new Object;a.arguments={uid:t};var n=ajax(top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::getOrderAction"],!1,a,"GET","json"),r=null;if(API.isset(n.order)){r=new XDate(n.order.date),$("#ab-bestellt-am").html(r.toString("dd.MM.yyyy HH:mm"));var i=new XDate((new XDate).addDays(2));6==i.getDay()?i=new XDate(i.addDays(2)):0==i.getDay()&&(i=new XDate(i.addDays(1))),$("#ab-edit-datum").val(i.toString("dd.MM.yyyy"))}for(var l="",o=n.conditions,s=0;s<o.length;s++)0==parseInt(o[s].days)?l+='<option value="'+o[s].uid+'" '+(o[s].uid==n.order.conditions?'selected="selected"':"")+">"+o[s].netto+" Tage netto</option>":l+='<option value="'+o[s].uid+'" '+(o[s].uid==n.order.conditions?'selected="selected"':"")+">"+o[s].days+" Tage "+o[s].reduction+"% Skonto, "+o[s].netto+" Tage netto</option>";$("#ab-edit-zahlung").html(l);var d="",u=n.order.article;Template.getAB.ini(n),d+=Template.getAB.artikel(u);var c=n.order.comment.werbelandRabatt;$("#werbelandRabatt").val(c),0==c?$("#werbelandInfo span").html("Nein"):$("#werbelandInfo span").html("Ja"),$("#ab-edit-Dialog-positionen table tbody").html(d),$("#ab-edit-vk").val(n.order.comment.versand.preis),API.isset(n.order.comment.versand.art)&&""!=n.order.comment.versand.art?$("#ab-edit-lieferung").val(n.order.comment.versand.art):$("#ab-edit-lieferung").val("abholung");var g="",h=n.adressen;for(s=0;s<h.length;s++)g+='<option value="'+h[s].uid+'" '+(API.isset(n.order.shippingadress)&&n.order.shippingadress.uid==h[s].uid||"abholung"!=n.order.comment.versand.art&&""!=n.order.comment.versand.art&&h[s].eigene&&!API.isset(n.order.shippingadress)?'selected="selected"':"")+">"+(h[s].eigene?"Eigene: ":"")+h[s].firma+" - "+h[s].name+"</option>";$("#ab-edit-adresse").html(g);var b=$("#ab-edit-Dialog")[0];$.data(b,"callerBtn",$(this).parent("li")),$("#ab-edit-Dialog").dialog("open")}),$("body").on("click",".feButton",function(e){e.preventDefault();var t=$(this).find("span").html();if(checkAB(t)){var a=$("#fe-edit-Dialog")[0];$.data(a,"callerBtn",$(this).parent("li")),$("#order-uid-fe-dialog").val(t),$("#fe-edit-Dialog").dialog("open")}else alert("Bitte erstellen Sie zunächst eine AB!")}),$("body").on("click",".lsButton",function(e){e.preventDefault();var t=$(this).find("span").html();if(checkAB(t)){var a=$("#ls-edit-Dialog")[0];$.data(a,"callerBtn",$(this).parent("li")),$("#order-uid-ls-dialog").val(t),$("#ls-edit-Dialog").dialog("open")}else alert("Bitte erstellen Sie zunächst eine AB!")}),$("body").on("click",".lsKButton",function(e){e.preventDefault();var t=$(this).find("span").html();if(checkAB(t)){var a=createFile(t,"lsK"),n=$("#ls-edit-Dialog")[0];$.data(n,"callerBtn",$(this).parent("li")),createDownload(a.fileName,"lsK"),a.fileName&&$(this).css("background-color","green")}else alert("Bitte erstellen Sie zunächst eine AB!")}),$("body").on("click",".reButton",function(e){e.preventDefault();var t=$(this).find("span").html();if(checkAB(t)){var a=new Object;a.arguments={uid:t};var n=ajax(top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::getOrderAction"],!1,a,"GET","json"),r=null;API.isset(n.order)&&(r=new XDate(n.order.date),$("#re-bestellt-am").html(r.toString("dd.MM.yyyy HH:mm")));var i=$("#re-edit-Dialog")[0];$.data(i,"callerBtn",$(this).parent("li")),$("#order-uid-re-dialog").val(t),$("#re-edit-Dialog").dialog("open")}else alert("Bitte erstellen Sie zunächst eine AB!")}),$("body").on("click",".reKButton",function(e){e.preventDefault();var t=$(this).find("span").html();if(checkAB(t)){var a=createFile(t,"reK"),n=$("#re-edit-Dialog")[0];$.data(n,"callerBtn",$(this).parent("li")),createDownload(a.fileName,"reK"),a.fileName&&$(this).css("background-color","green")}else alert("Bitte erstellen Sie zunächst eine AB!")}),$("body").on("click",".dxfButton",function(e){e.preventDefault();var t=$(this).find("span").html(),a=new Object;a.arguments={uid:t};var n=ajax(top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::getDxfAction"],!1,a,"GET","json");if(API.isset(n)){for(var r="<p>Dateien zum Downloaden: <br/>",i="<p>Erstellung fehlgeschlagen: <br/>",l=0;l<n.length;l++)n[l].res?r+="<b>Position "+n[l].pos+': </b><a class="dxfDownload" href="'+n[l].file+'">'+n[l].file+"</a><br/>":i+="<b>Position "+n[l].pos+": </b>"+n[l].file+"</a><br/>";r+="</p>",i+="</p>",$("#dxf-Dialog-daten").html(r+i),$("#dxf-Dialog").dialog("open")}}),$("body").on("click",".dxfDownload",function(e){e.preventDefault(),createDownload($(this).attr("href"),"dxf")}),$("body").on("click","#abschluss-bestellungen-btn",function(e){e.preventDefault();var t=new Object;t.arguments={von:$("#abschluss-von").val(),bis:$("#abschluss-bis").val()},showAbschlussData(ajax(top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::getAbschlussAction"],!1,t,"GET","json"))}),$("body").on("click","#create-abschluss-btn",function(e){e.preventDefault();var t=new Object;t.arguments={von:$("#abschluss-von").val(),bis:$("#abschluss-bis").val(),generate:!0},createDownload(ajax(top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::getAbschlussAction"],!1,t,"GET","json").fileName,"abschluss")}),$(".abschluss-range .input-group.date").datepicker({format:"dd.mm.yyyy",minViewMode:1,clearBtn:!0,language:"de"}).on("changeDate",function(e){var t=new XDate(e.date),a=XDate.getDaysInMonth(t.getYear(),t.getMonth()),n=new XDate(t.setDate(a));$("#abschluss-bis").val(n.toString("dd.MM.yyyy"))}).on("clearDate",function(e){$("#abschluss-von").val(""),$("#abschluss-bis").val("")}),$("#ab-edit-Dialog").dialog({autoOpen:!1,resizable:!0,height:"auto",width:"90%",modal:!0,buttons:{OK:function(){var e=$("#order-uid-ab-dialog").val(),t=new Object;if(t.arguments={uid:e,opt:"ab",lieferzeit:$("#ab-edit-datum").val(),lieferart:$("#ab-edit-lieferung").val(),lieferadresse:$("#ab-edit-adresse").val(),versandkosten:$("#ab-edit-vk").val(),zahlung:$("#ab-edit-zahlung").val(),hinweis:$("#ab-edit-text").val(),ausland:$("#ab-edit-country").is(":checked")?"true":"false"},ajax(top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::editOrderAction"],!1,t,"GET","json").res){var a=createFile(e,"ab");if(createDownload(a.fileName,"ab"),a.fileName){var n=$.data($("#ab-edit-Dialog")[0],"callerBtn");$(n).attr("style","background-color:rgba(155,255,196,0.8)")}}$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),$("#fe-edit-Dialog").dialog({autoOpen:!1,resizable:!0,height:140,modal:!0,buttons:{OK:function(){var e=createFile($("#order-uid-fe-dialog").val(),"fe");if(createDownload(e.fileName,"fe"),e.fileName){var t=$.data($("#fe-edit-Dialog")[0],"callerBtn");$(t).attr("style","background-color:rgba(155,255,196,0.8)")}$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),$("#ls-edit-Dialog").dialog({autoOpen:!1,resizable:!0,height:140,modal:!0,buttons:{OK:function(){var e=createFile($("#order-uid-ls-dialog").val(),"ls");if(createDownload(e.fileName,"ls"),e.fileName){var t=$.data($("#ls-edit-Dialog")[0],"callerBtn");$(t).attr("style","background-color:rgba(155,255,196,0.8)")}$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),$("#re-edit-Dialog").dialog({autoOpen:!1,resizable:!0,height:"auto",width:"90%",modal:!0,buttons:{OK:function(){var e=$("#order-uid-re-dialog").val(),t=new Object;if(t.arguments={uid:e,opt:"re",lieferdatum:$("#re-edit-datum").val(),lieferart:$("#re-edit-lieferart").val(),versandNach:$("#re-edit-versandNach").val(),nachlass:$("#re-edit-nachlass").val(),nachlassEinheit:$("#re-edit-nachlassEinheit").val(),ausland:$("#re-edit-country").is(":checked")?"true":"false"},ajax(top.TS.PATH_typo3+TYPO3.settings.ajaxUrls["Glshop::editOrderAction"],!1,t,"GET","json").res){var a=createFile(e,"re");if(createDownload(a.fileName,"re"),a.fileName){var n=$.data($("#re-edit-Dialog")[0],"callerBtn");$(n).attr("style","background-color:rgba(155,255,196,0.8)")}}$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),$("#dxf-Dialog").dialog({autoOpen:!1,resizable:!0,height:300,modal:!0,buttons:{OK:function(){$(this).dialog("close")}}})})}(jQuery);